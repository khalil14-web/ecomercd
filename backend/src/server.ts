// ==============================
// ๐ฆ 1. ุงุณุชูุฑุงุฏ ุงูููุชุจุงุช ุงููุงุฒูุฉ
// ==============================
import mongoose from "mongoose"; // ููุชุจุฉ ููุชุนุงูู ูุน MongoDB
import dotenv from "dotenv";     // ููุชุจุฉ ูุชุญููู ุงููุชุบูุฑุงุช ูู ููู .env
import app from "./app";         // ุงุณุชูุฑุงุฏ ุชุทุจูู Express ุงูุฑุฆูุณู

// ==============================
// โ๏ธ 2. ุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ
// ==============================
dotenv.config(); // ุชุญููู ุงูููู ูู ููู .env ุฅูู process.env

// ==============================
// ๐ 3. ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
// ==============================
const DB_URI = process.env.DATABASE_URI || ""; // ุฌูุจ ุฑุงุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ููู .env

mongoose
  .connect(DB_URI) // ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
  .then(() => console.log("โ MongoDB Connected")) // ูู ุญุงู ูุฌุงุญ ุงูุงุชุตุงู
  .catch((err) => console.log("โ Database connection error:", err)); // ูู ุญุงู ุญุฏูุซ ุฎุทุฃ

// ==============================
// ๐ 4. ุชุดุบูู ุงูุฎุงุฏู (Server)
// ==============================
const port = process.env.PORT || 3000; // ุชุญุฏูุฏ ุงููููุฐ (ูู .env ุฃู 3000 ูุงูุชุฑุงุถู)
const server = app.listen(port, () => {
  console.log(`โ Server running on port ${port}`);
});

// ======================================================
// โ๏ธ 5. ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก ุบูุฑ ุงููุนุงูุฌุฉ (Unhandled Rejections)
// ======================================================
//
// ุฃุญูุงููุง ูู Node.js ูููู ุฃู ูุญุฏุซ "ุฑูุถ ูููุนุฏ" (Promise Rejection)
// ุจุฏูู ุฃู ูุณุชุฎุฏู try/catch ุฃู .catch() ููุนุงูุฌุชู.
// ูุฐุง ุงููุณู ููุชูุท ูุซู ูุฐู ุงูุญุงูุงุช ููุบูู ุงูุณูุฑูุฑ ุจุฃูุงู.
//
// ุฃูุซูุฉ ุนูู ูุฐู ุงูุฃุฎุทุงุก: ูุดู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุชุ ุฎุทุฃ ูู Promiseุ ุฅูุฎ.
//
process.on("unhandledRejection", (err: any) => {
  console.log("๐ฅ UNHANDLED REJECTION! Shutting down gracefully...");
  console.log("Error name:", err.name);
  console.log("Error message:", err.message);

  // ุฅุบูุงู ุงูุณูุฑูุฑ ุฃููุงู ุจุดูู ุขูู ูุจู ุฅููุงุก ุงูุนูููุฉ
  server.close(() => {
    process.exit(1); // 1 = ุฅููุงุก ุจุณุจุจ ุฎุทุฃ
  });
});

/* 
๐ง ููุงุญุธุงุช ููููู:
- process: ูุงุฆู ุนุงู ูู Node.js ููุซู ุงูุนูููุฉ ุงูุญุงููุฉ.
- .on(): ูุฑุจุท ูุณุชูุนูุง (listener) ุจุญุฏุซ ูุนูู (event).
- "unhandledRejection": ูู ุงูุญุฏุซ ุงูุฐู ููุซุงุฑ ุนูุฏ ูุฌูุฏ ูุนุฏ (Promise) ุชู ุฑูุถู ุฏูู ูุนุงูุฌุฉ.
*/
